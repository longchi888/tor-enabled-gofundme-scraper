# GoFundMe增强版资源爬取脚本 v2.0

## 🚀 重大升级说明

基于原版本的深度分析，v2.0版本完全重写了核心架构，解决了所有已知问题。

### 🆚 **版本对比**

| 功能特性 | v1.0 | v2.0 (Enhanced) |
|---------|------|-----------------|
| 网络安全检查 | 基础Tor检查 | **IP对比显示 + 用户选择确认** |
| 实时监控 | 无 | **30秒间隔IP泄露监控** |
| 断点续传 | ❌ | **✅ 智能断点续传** |  
| 用户交互 | 命令行参数 | **交互式选择界面** |
| 代码架构 | 全局变量 | **OOP设计 + 合理封装** |
| 错误处理 | 基础重试 | **指数退避 + 详细日志** |
| 磁盘管理 | 无检查 | **空间预检 + 安全文件名** |
| 安全级别 | 中等 | **军事级别安全保护** |

## 🔒 **核心安全升级**

### **1. 智能网络检测**
```
🌐 网络安全状态检查
========================
🔍 正在检查当前网络状态...

📍 当前真实IP地址: 123.45.67.89

⚠️ 安全警告:
   使用真实IP访问GoFundMe可能暴露您的身份和位置
   强烈建议使用Tor网络进行匿名访问

📋 请选择操作:
   1. 继续检查Tor连接（推荐）
   2. 使用真实IP继续（不推荐）
   3. 退出脚本

请输入选择 (1/2/3):
```

### **2. IP对比验证**
```
🎯 IP地址对比:
   真实IP: 123.45.67.89
   Tor IP:  185.220.101.42
   ✅ IP地址不同，Tor连接有效

🔒 Tor连接验证成功！
   您的网络流量将通过Tor网络进行匿名处理
```

### **3. 实时安全监控**
```
🔒 已启动实时IP泄露监控
   - 每30秒检查一次Tor连接状态
   - 发现IP泄露立即终止程序
   - 监控Tor出口节点变化
```

## 📋 **使用流程**

### **第一阶段：安全检查**
1. 脚本启动后自动检测当前真实IP
2. 显示安全警告和操作选项
3. 用户选择是否使用Tor网络
4. 如选择Tor，进行连接验证和IP对比
5. 启动实时IP监控保护

### **第二阶段：资源收集** 
1. 使用Tor网络访问桌面版页面
2. 收集所有CSS、JS、字体、图片资源链接
3. 等待5秒后切换到移动版
4. 收集移动版资源并自动去重合并
5. 保存桌面版和移动版HTML文件

### **第三阶段：批量下载**
1. 生成完整下载清单
2. 检查磁盘空间是否充足
3. 用户确认是否开始下载
4. 启动3线程智能下载（支持断点续传）
5. 实时显示下载进度和统计

## 🛠️ **快速开始**

### 1. 环境准备
```bash
pip install playwright requests PySocks
playwright install chromium
```

### 2. 启动Tor Browser
- 打开Tor Browser并确保连接成功
- 保持运行状态（脚本会自动检测端口9150/9050）

### 3. 运行脚本
```bash
python scrape_gofundme_enhanced.py
```

## 💡 **智能特性说明**

### **🔄 断点续传**
```
📄 加载断点续传数据: 67 个文件已完成
🚀 开始批量下载 150 个文件...
   最大并发: 3 个线程
   断点续传: 67 个文件已完成
```

脚本会自动保存下载进度到 `.download_progress.json`，中断后重新运行会自动跳过已完成的文件。

### **🧠 智能重试机制**
```
❌ 失败: Connection timeout (尝试 1/3)
⏱️ 等待 2 秒后重试...
❌ 失败: HTTP 403 Forbidden (尝试 2/3)  
⏱️ 等待 4 秒后重试...
✅ 完成: main.css
```

使用指数退避算法：第1次重试等待2秒，第2次等待4秒，第3次等待8秒。

### **💾 磁盘空间管理**
```
✅ 磁盘空间充足: 可用 2048MB
```

下载前自动检查可用空间，默认需要500MB最小空间。

### **📁 智能文件命名**
```
原URL: https://www.gofundme.com/ssr/_next/static/css/799da7baf70de7be.css?v=12345
安全文件名: 799da7baf70de7be.css

长URL: https://example.com/very/long/path/with/parameters?id=12345&token=abcdef  
哈希文件名: css_a1b2c3d4.css
```

自动处理特殊字符、长文件名和无扩展名的URL。

## 🔧 **高级配置**

### **调整下载并发数**
```python
# 修改第284行
downloader = DownloadManager(proxy_url, max_workers=5)  # 默认3
```

### **修改监控间隔**
```python  
# 修改第109行
check_interval = 60  # 改为60秒检查一次，默认30秒
```

### **调整重试参数**
```python
# 修改第234行  
def download_file(self, url: str, save_path: str, max_retries: int = 5):  # 默认3
```

## 📊 **输出文件结构**

```
gofundme/scraped_resources/
├── desktop/
│   └── index.html                 # 桌面版完整HTML
├── mobile/  
│   └── index.html                 # 移动版完整HTML
├── merged/                        # 合并去重的所有资源
│   ├── css/                       # 所有CSS文件
│   │   ├── main.css
│   │   ├── chunk-vendors.css
│   │   └── ...
│   ├── js/                        # 所有JS文件  
│   │   ├── app.js
│   │   ├── chunk-common.js
│   │   └── ...
│   ├── fonts/                     # 所有字体文件
│   │   ├── GoFundMeSans-Regular.woff2
│   │   └── ...
│   └── images/                    # 所有图片文件
│       ├── logo.png
│       └── ...
├── .download_progress.json        # 断点续传进度文件
├── failed_downloads_YYYYMMDD_HHMMSS.json  # 失败下载报告
└── logs/                          # 日志目录（预留）
```

## ⚡ **性能优化建议**

### **网络环境优化**
- 使用稳定的Tor连接
- 避免频繁切换出口节点
- 选择网络空闲时段运行

### **下载效率优化** 
```python
# 稳定网络环境 - 可提高并发
max_workers = 5

# 不稳定网络环境 - 降低并发  
max_workers = 2

# 快速模式 - 减少重试
max_retries = 1  

# 稳定模式 - 增加重试
max_retries = 5
```

## 🚨 **安全注意事项**

### **IP泄露零容忍**
- 脚本检测到IP泄露会**立即终止**程序
- 绝不允许真实IP暴露给目标网站
- 建议在虚拟机中运行增加安全层

### **Tor网络最佳实践**
- 使用最新版本的Tor Browser
- 定期更新Tor配置
- 避免同时运行其他网络密集型应用

### **法律和伦理**
- 仅用于学习和研究目的
- 遵守目标网站的robots.txt  
- 控制访问频率，避免对服务器造成压力
- 不得用于任何商业或恶意目的

## 🐛 **故障排除**

### **常见问题**

**Q: 脚本提示"端口不可访问"**
```
A: 确保Tor Browser正在运行，或启动独立Tor服务：
   tor --SocksPort 9050
```

**Q: IP对比显示相同地址**  
```
A: Tor连接未生效，检查：
   1. 防火墙设置
   2. Tor Browser连接状态
   3. 代理配置是否正确
```

**Q: 下载速度很慢**
```
A: 这是正常现象，因为：
   1. Tor网络本身较慢
   2. 脚本限制了并发数保护Tor网络
   3. 增加重试机制确保完整性
```

**Q: 断点续传不工作**
```
A: 检查：
   1. .download_progress.json 文件是否存在
   2. 文件权限是否正确  
   3. 磁盘空间是否充足
```

## 📈 **版本更新计划**

- **v2.1**: 添加GUI界面
- **v2.2**: 支持多目标URL批量处理  
- **v2.3**: 集成图片压缩和优化
- **v2.4**: 增加自动部署功能

## 📞 **技术支持**

遇到问题请按以下顺序检查：
1. 网络连接和Tor状态
2. Python依赖完整性  
3. 磁盘空间和权限
4. 脚本输出的详细错误信息

---

**免责声明**: 本工具仅供学习研究使用，用户需对使用行为承担完全责任。

**版本信息**: v2.0 Enhanced | 2025-09-10 | Python 3.7+