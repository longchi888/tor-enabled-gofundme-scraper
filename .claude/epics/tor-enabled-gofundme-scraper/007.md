---
id: task-007
title: 输出格式兼容
epic: tor-enabled-gofundme-scraper
type: task
status: todo
priority: high
created: 2025-09-14T22:14:31Z
updated: 2025-09-14T22:14:31Z
dependencies:
  - task-005
  - task-006
blocks: []
parallel: false
estimate: 1 day
---

# 输出格式兼容

## 目标
确保重构后的爬虫输出的JSON元数据和HTML文件格式与现有脚本完全一致，实现无缝迁移。

## 需求描述

### 核心功能
- JSON元数据格式标准化
- HTML文件结构保持一致
- 桌面/移动端输出差异处理
- 向后兼容性验证

### 技术要求
- 实现OutputFormatter统一输出管理
- 对比现有输出格式进行精确匹配
- 支持增量输出和批量处理
- 提供格式验证和质量检查

### 实现细节
- **JSON格式对齐**: 确保字段名称、数据类型、嵌套结构完全匹配
- **HTML文件处理**: 保持页面HTML的完整性和格式
- **目录结构**: 严格遵循`desktop/mobile`分离的目录约定
- **文件命名**: 保持哈希命名规则和扩展名约定

### 输出格式规范
1. **JSON元数据结构**:
   ```json
   {
     "url": "string",
     "timestamp": "ISO8601",
     "mode": "desktop|mobile",
     "content": {...},
     "resources": [...],
     "extraction_info": {...}
   }
   ```

2. **文件组织结构**:
   ```
   scraped_resources_ultra/
   ├── desktop/
   │   ├── [hash].json
   │   ├── [hash].html
   │   └── resources/
   └── mobile/
       ├── [hash].json
       ├── [hash].html
       └── resources/
   ```

## 验收标准
- [ ] JSON输出格式100%匹配现有脚本
- [ ] HTML文件结构和内容一致
- [ ] 目录结构完全兼容
- [ ] 文件命名规则保持不变
- [ ] 桌面/移动端输出正确分离
- [ ] 格式验证工具实现完成
- [ ] 兼容性测试通过率100%
- [ ] 回归测试覆盖所有输出场景

## 技术债务
- 考虑添加输出格式版本控制
- 实现更详细的元数据记录
- 添加输出质量评分机制

## 风险评估
- **低**: JSON字段遗漏或类型不匹配
- **低**: HTML编码或格式问题
- **极低**: 目录权限或文件系统问题

## 相关文件
- gofundme/scrape_gofundme_enhanced.py (参考输出格式)
- 现有输出示例文件 (格式基准)
- crawl4ai/utils/file_utils.py (文件操作工具)

## 集成依赖
此任务必须等待task-005(智能数据提取)和task-006(资源收集重构)完成后才能开始，因为需要整合两个任务的输出结果进行统一格式化。

## 验证方法
1. **格式对比**: 使用diff工具对比新旧输出文件
2. **结构验证**: JSON schema验证确保数据结构正确
3. **兼容性测试**: 现有工具能否正常处理新输出
4. **完整性检查**: 确保所有必要信息都已包含